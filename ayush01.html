<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ayush Tech Routine Schedule AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Sunset Glow -->
    <!-- Application Structure Plan: A responsive two-column layout. The left column is the fixed 'AI Command Center'. The right column is the scrollable content area, featuring a 'Past Routines' history section with delete functionality, followed by the motivational quote, the active schedule, analysis chart, and tips. This structure enhances usability by allowing users to manage and revisit AI-generated schedules. -->
    <!-- Visualization & Content Choices: Core features remain: interactive schedule cards, a daily motivational quote via Gemini API, and a dynamic Chart.js donut chart. The 'Past Routines' history now includes delete buttons, which manipulate the `pastSchedules` array in localStorage and re-render the UI, making the assistant a more robust planning tool. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #fffaf0; /* Light cream background */
        }
        .ai-panel {
            background-color: #ffffff;
            border-right: 1px solid #fee2e2;
        }
        .content-container::-webkit-scrollbar { width: 6px; }
        .content-container::-webkit-scrollbar-track { background: #fffaf0; }
        .content-container::-webkit-scrollbar-thumb { background: #ff7e5f; border-radius: 6px; }
        
        .prompt-input {
            background-color: #fef3c7;
            border: 1px solid #fde68a;
            color: #92400e;
        }
        .prompt-input:focus {
            border-color: #ff7e5f;
            box-shadow: 0 0 0 2px rgba(255, 126, 95, 0.2);
        }
        .generate-btn {
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 126, 95, 0.3);
        }
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 126, 95, 0.4);
        }
        .history-btn-wrapper {
            display: inline-flex;
            align-items: center;
            background-color: #fff7ed;
            border: 1px solid #fed7aa;
            border-radius: 9999px;
            transition: all 0.2s ease;
        }
        .history-btn-wrapper:hover, .history-btn-wrapper.active {
             background-color: #ff7e5f;
             border-color: #ff7e5f;
        }
        .history-btn {
            color: #c2410c;
            padding: 4px 12px;
            transition: color 0.2s ease;
        }
        .history-btn-wrapper:hover .history-btn, .history-btn-wrapper.active .history-btn {
            color: white;
        }
        .delete-history-btn {
            color: #fb923c;
            padding: 4px 8px;
            border-left: 1px solid #fed7aa;
            transition: all 0.2s ease;
        }
        .history-btn-wrapper:hover .delete-history-btn, .history-btn-wrapper.active .delete-history-btn {
            color: #fed7aa;
            border-color: #fdba74;
        }
        .delete-history-btn:hover {
            color: white !important;
            background-color: rgba(0,0,0,0.1);
        }

        .task-card {
            background-color: white;
            transition: all 0.3s ease;
            border-left-width: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.07);
        }
        .task-card.completed {
            opacity: 0.65;
            background-color: #f9fafb;
        }
        .task-card.completed .activity-text {
            text-decoration: line-through;
            color: #6b7280;
        }
        .chart-container {
            position: relative;
            height: 280px;
            width: 100%;
        }
        .loader {
            border: 4px solid #fee2e2;
            border-top: 4px solid #ff7e5f;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="h-screen overflow-hidden">

    <div class="flex h-full">
        <!-- Left AI Panel -->
        <div class="ai-panel w-full md:w-1/3 lg:w-1/4 h-full flex flex-col p-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-4">AI Schedule Generator</h1>
            <p class="text-sm text-gray-500 mb-6">Aapka din, aapke haath mein. Command dekar apna schedule banayein ya badlein.</p>
            
            <label for="ai-prompt" class="block text-sm font-medium text-gray-700 mb-2">Aapka Command:</label>
            <textarea id="ai-prompt" rows="4" class="prompt-input w-full rounded-md p-2 focus:outline-none text-sm placeholder-amber-800/50" placeholder="e.g., 'Ek student ke liye routine banao jo exams ki taiyari kar raha hai.'"></textarea>

            <button id="generate-btn" class="generate-btn w-full text-white font-bold py-2.5 px-4 rounded-lg mt-4 shadow-md hover:shadow-lg">
                Generate Schedule
            </button>
            <div id="loader" class="mx-auto mt-4 hidden">
                <div class="loader"></div>
            </div>
            <div id="error-message" class="text-red-500 text-sm mt-2 text-center hidden"></div>
        </div>

        <!-- Right Content Display -->
        <div class="content-container w-full md:w-2/3 lg:w-3/4 h-full p-6 sm:p-8 overflow-y-auto">
            <section id="history-section" class="mb-8">
                <h2 class="text-xl font-bold text-gray-800 mb-3">Past Routines</h2>
                <div id="history-buttons-container" class="flex flex-wrap gap-3">
                    <!-- History buttons will be injected here -->
                </div>
            </section>

            <section id="ai-quote-section" class="mb-8 bg-gradient-to-r from-orange-400 to-rose-400 text-white p-6 rounded-xl shadow-lg">
                <h2 class="text-lg font-semibold mb-2">‚ú® Aaj Ka Vichar</h2>
                <p id="motivational-quote" class="text-lg italic">Loading your daily dose of motivation...</p>
            </section>

            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                <div class="xl:col-span-2">
                    <h2 id="routine-title" class="text-2xl font-bold text-gray-800 mb-4">Daily Routine</h2>
                    <div id="schedule-container" class="space-y-3"></div>
                </div>
                
                <div class="xl:col-span-1 space-y-8">
                    <section>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Time Analysis</h2>
                        <div class="bg-white p-6 rounded-xl shadow-md">
                            <div class="chart-container">
                                <canvas id="timeAnalysisChart"></canvas>
                            </div>
                        </div>
                    </section>
                    <section>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">üìù Extra Tips</h2>
                        <div class="space-y-4">
                            <div class="bg-white p-5 rounded-xl shadow-md border-l-4 border-blue-400">
                                <h3 class="font-bold text-gray-800">Har Ravivar Ko</h3>
                                <p class="text-gray-600 text-sm mt-1">Hafte ka revision karein aur rest lein.</p>
                            </div>
                            <div class="bg-white p-5 rounded-xl shadow-md border-l-4 border-green-400">
                                <h3 class="font-bold text-gray-800">Growth Mirror</h3>
                                <p class="text-gray-600 text-sm mt-1">Raat ka revision aapki growth ka aaina hai.</p>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <script>
        const initialScheduleData = [
            { time: '4:00 AM ‚Äì 4:10 AM', activity: 'Wake up + 1 glass water', category: 'Health', completed: false },
            { time: '4:10 AM ‚Äì 4:30 AM', activity: 'Freshen up + Brush', category: 'Personal', completed: false },
            { time: '4:30 AM ‚Äì 4:50 AM', activity: 'Morning Walk (20 mins)', category: 'Health', completed: false },
            { time: '4:50 AM ‚Äì 5:35 AM', activity: 'Home Workout (30 mins) + Meditation (15 mins)', category: 'Health', completed: false },
            { time: '5:35 AM ‚Äì 6:00 AM', activity: 'Healthy Breakfast', category: 'Health', completed: false },
            { time: '6:00 AM ‚Äì 6:15 AM', activity: 'Bath', category: 'Personal', completed: false },
            { time: '6:15 AM ‚Äì 7:30 AM', activity: 'Good Books Reading', category: 'Study', completed: false },
            { time: '7:30 AM ‚Äì 8:30 AM', activity: 'Travel to English Speaking Course', category: 'Personal', completed: false },
            { time: '8:30 AM ‚Äì 10:30 AM', activity: 'Attend English Speaking Class', category: 'Study', completed: false },
            { time: '10:30 AM ‚Äì 11:30 AM', activity: 'Return home + Light rest', category: 'Personal', completed: false },
            { time: '11:30 AM ‚Äì 12:00 PM', activity: 'Prepare and eat lunch', category: 'Personal', completed: false },
            { time: '12:00 PM ‚Äì 1:00 PM', activity: 'Instagram (Limit 1 hour)', category: 'Personal', completed: false },
            { time: '1:00 PM ‚Äì 2:00 PM', activity: 'Programming Practice (DSA / Python)', category: 'Study', completed: false },
            { time: '2:00 PM ‚Äì 2:10 PM', activity: 'Break (Water + Stretch)', category: 'Personal', completed: false },
            { time: '2:10 PM ‚Äì 3:10 PM', activity: 'Project Work / Online Course (AI, ML)', category: 'Study', completed: false },
            { time: '3:10 PM ‚Äì 3:20 PM', activity: 'Break', category: 'Personal', completed: false },
            { time: '3:20 PM ‚Äì 4:00 PM', activity: 'Resume Programming Tasks', category: 'Study', completed: false },
            { time: '4:00 PM ‚Äì 4:30 PM', activity: 'Evening Walk', category: 'Health', completed: false },
            { time: '4:30 PM ‚Äì 6:30 PM', activity: 'NIMCET Math + Reasoning', category: 'Study', completed: false },
            { time: '6:30 PM ‚Äì 7:00 PM', activity: 'Tea/Light Snack Break', category: 'Personal', completed: false },
            { time: '7:00 PM ‚Äì 9:00 PM', activity: 'NIMCET PYQs + Speed Practice', category: 'Study', completed: false },
            { time: '9:00 PM ‚Äì 9:30 PM', activity: 'Dinner', category: 'Health', completed: false },
            { time: '9:30 PM ‚Äì 9:50 PM', activity: 'Light Walk Post Dinner', category: 'Health', completed: false },
            { time: '9:50 PM ‚Äì 10:30 PM', activity: 'Daily Revision & Analysis', category: 'Study', completed: false },
            { time: '10:30 PM ‚Äì 4:00 AM', activity: 'Sleep', category: 'Health', completed: false }
        ];

        let currentScheduleData = JSON.parse(localStorage.getItem('currentSchedule')) || [...initialScheduleData];
        let pastSchedules = JSON.parse(localStorage.getItem('pastSchedules')) || [];
        let timeChart = null;
        let activeHistoryIndex = -1; // -1 represents the main/current schedule

        const categoryStyles = {
            'Study': { color: '#60a5fa', name: 'Study' },
            'Health': { color: '#4ade80', name: 'Health' },
            'Personal': { color: '#facc15', name: 'Personal' }
        };

        function displaySchedule(schedule, title = "Daily Routine", historyIdx = -1) {
            activeHistoryIndex = historyIdx;
            const container = document.getElementById('schedule-container');
            document.getElementById('routine-title').textContent = title;
            container.innerHTML = '';
            schedule.forEach((item, index) => {
                const style = categoryStyles[item.category] || { color: '#9ca3af' };
                const card = document.createElement('div');
                card.className = `task-card p-4 rounded-lg flex items-center justify-between ${item.completed ? 'completed' : ''}`;
                card.style.borderColor = style.color;
                card.innerHTML = `
                    <div class="flex-grow">
                        <p class="font-semibold text-gray-800 activity-text">${item.activity}</p>
                        <p class="text-sm text-gray-500">${item.time}</p>
                    </div>
                    <input type="checkbox" class="form-checkbox h-5 w-5 text-orange-500 rounded focus:ring-orange-400 cursor-pointer" data-index="${index}" ${item.completed ? 'checked' : ''}>
                `;
                container.appendChild(card);
            });
            renderOrUpdateChart(schedule);
            updateHistoryButtons();
        }

        async function fetchMotivationalQuote() {
            const quoteElement = document.getElementById('motivational-quote');
            const today = new Date().toDateString();
            const storedData = JSON.parse(localStorage.getItem('dailyQuote'));
            if (storedData && storedData.date === today) {
                quoteElement.textContent = storedData.quote;
                return;
            }
            const prompt = "Generate a short, powerful, and inspiring motivational quote for a student who is working hard. Keep it under 15 words.";
            try {
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiKey = ""; // IMPORTANT: Paste your Gemini API Key here
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error('Failed to fetch quote');
                const result = await response.json();
                const quote = result.candidates[0].content.parts[0].text.replace(/"/g, '');
                quoteElement.textContent = quote;
                localStorage.setItem('dailyQuote', JSON.stringify({ quote, date: today }));
            } catch (error) {
                quoteElement.textContent = "Success is the sum of small efforts, repeated day in and day out.";
            }
        }

        function calculateTimeDistribution(schedule) {
            const distribution = { Study: 0, Health: 0, Personal: 0 };
            const parseTime = (timeStr) => {
                const parts = timeStr.match(/(\d+):?(\d+)?\s*(AM|PM)/i);
                if (!parts) return null;
                let hours = parseInt(parts[1], 10);
                const minutes = parseInt(parts[2], 10) || 0;
                const period = parts[3].toUpperCase();
                if (period === 'PM' && hours !== 12) hours += 12;
                if (period === 'AM' && hours === 12) hours = 0;
                return hours * 60 + minutes;
            };

            schedule.forEach(item => {
                const timeParts = item.time.split('‚Äì');
                if (timeParts.length !== 2) return;
                let startMinutes = parseTime(timeParts[0].trim());
                let endMinutes = parseTime(timeParts[1].trim());
                if (startMinutes === null || endMinutes === null) return;
                if (endMinutes < startMinutes) endMinutes += 24 * 60;
                const duration = endMinutes - startMinutes;
                if (distribution[item.category] !== undefined && duration > 0) {
                    distribution[item.category] += duration;
                }
            });
            for (const category in distribution) {
                distribution[category] = (distribution[category] / 60).toFixed(2);
            }
            return distribution;
        }

        function renderOrUpdateChart(schedule) {
            const timeDistribution = calculateTimeDistribution(schedule);
            const chartData = {
                labels: Object.values(categoryStyles).map(s => s.name),
                datasets: [{
                    data: Object.values(timeDistribution),
                    backgroundColor: Object.values(categoryStyles).map(s => s.color),
                    borderColor: '#ffffff',
                    borderWidth: 4,
                }]
            };
            if (timeChart) {
                timeChart.data = chartData;
                timeChart.update();
            } else {
                const ctx = document.getElementById('timeAnalysisChart').getContext('2d');
                timeChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: chartData,
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom', labels: { padding: 15, font: { size: 12 } } },
                            tooltip: { callbacks: { label: (context) => `${context.label}: ${context.parsed} hours` } }
                        }
                    }
                });
            }
        }

        function updateHistoryButtons() {
            const container = document.getElementById('history-buttons-container');
            container.innerHTML = '';
            // Add button for the main schedule
            const mainBtnWrapper = document.createElement('div');
            mainBtnWrapper.className = 'history-btn-wrapper';
            if (activeHistoryIndex === -1) mainBtnWrapper.classList.add('active');
            mainBtnWrapper.innerHTML = `<button class="history-btn text-sm font-semibold" data-index="-1">Ayush's Default</button>`;
            container.appendChild(mainBtnWrapper);

            pastSchedules.forEach((_, index) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'history-btn-wrapper';
                 if (activeHistoryIndex === index) wrapper.classList.add('active');
                wrapper.innerHTML = `
                    <button class="history-btn text-sm font-semibold" data-index="${index}">Routine #${index + 1}</button>
                    <button class="delete-history-btn" data-delete-index="${index}">&#x1F5D1;&#xFE0F;</button>
                `;
                container.appendChild(wrapper);
            });
        }

        async function handleGenerateSchedule() {
            const userPrompt = document.getElementById('ai-prompt').value.trim();
            if (!userPrompt) return;
            const loader = document.getElementById('loader');
            const errorMsg = document.getElementById('error-message');
            const generateBtn = document.getElementById('generate-btn');
            loader.classList.remove('hidden');
            errorMsg.classList.add('hidden');
            generateBtn.disabled = true;

            const fullPrompt = `You are an expert productivity coach. A user wants a personalized daily schedule. Based on their request, create a complete, logical, 24-hour schedule. Ensure all time slots have a start and end time with AM/PM (e.g., '8:00 AM ‚Äì 9:00 AM'). The output MUST be a valid JSON array of objects, where each object has three keys: "time" (string), "activity" (string), and "category" (string: 'Study', 'Health', or 'Personal'). Do not include any explanatory text. User's Request: "${userPrompt}"`;
            try {
                let chatHistory = [{ role: "user", parts: [{ text: fullPrompt }] }];
                const payload = {
                    contents: chatHistory,
                    generationConfig: { responseMimeType: "application/json", responseSchema: { type: "ARRAY", items: { type: "OBJECT", properties: { "time": { "type": "STRING" }, "activity": { "type": "STRING" }, "category": { "type": "STRING" } }, required: ["time", "activity", "category"] } } }
                };
                const apiKey = ""; // IMPORTANT: Paste your Gemini API Key here
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`API Error: ${response.statusText}`);
                const result = await response.json();
                const newSchedule = JSON.parse(result.candidates[0].content.parts[0].text).map(item => ({ ...item, completed: false }));
                pastSchedules.push(currentScheduleData);
                localStorage.setItem('pastSchedules', JSON.stringify(pastSchedules));
                currentScheduleData = newSchedule;
                localStorage.setItem('currentSchedule', JSON.stringify(currentScheduleData));
                displaySchedule(currentScheduleData, "New AI Generated Routine", -1);
            } catch (error) {
                errorMsg.textContent = 'Failed to generate schedule. Please try again.';
                errorMsg.classList.remove('hidden');
            } finally {
                loader.classList.add('hidden');
                generateBtn.disabled = false;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            displaySchedule(currentScheduleData, "Ayush's Default Routine", -1);
            fetchMotivationalQuote();
            
            document.getElementById('generate-btn').addEventListener('click', handleGenerateSchedule);
            
            document.getElementById('schedule-container').addEventListener('change', (e) => {
                if (e.target.matches('.form-checkbox')) {
                    const index = parseInt(e.target.dataset.index, 10);
                    const scheduleToUpdate = (activeHistoryIndex === -1) ? currentScheduleData : pastSchedules[activeHistoryIndex];
                    
                    if (scheduleToUpdate && scheduleToUpdate[index]) {
                        scheduleToUpdate[index].completed = e.target.checked;
                        if (activeHistoryIndex === -1) {
                            localStorage.setItem('currentSchedule', JSON.stringify(currentScheduleData));
                        } else {
                            localStorage.setItem('pastSchedules', JSON.stringify(pastSchedules));
                        }
                        const currentTitle = document.getElementById('routine-title').textContent;
                        displaySchedule(scheduleToUpdate, currentTitle, activeHistoryIndex);
                    }
                }
            });

            document.getElementById('history-buttons-container').addEventListener('click', (e) => {
                const viewBtn = e.target.closest('.history-btn');
                const deleteBtn = e.target.closest('.delete-history-btn');

                if (deleteBtn) {
                    const indexToDelete = parseInt(deleteBtn.dataset.deleteIndex, 10);
                    pastSchedules.splice(indexToDelete, 1);
                    localStorage.setItem('pastSchedules', JSON.stringify(pastSchedules));
                    // If the deleted routine was active, switch to the main one
                    if (activeHistoryIndex === indexToDelete) {
                        displaySchedule(currentScheduleData, "Ayush's Default Routine", -1);
                    } else {
                        updateHistoryButtons();
                    }
                    return;
                }

                if (viewBtn) {
                    const index = parseInt(viewBtn.dataset.index, 10);
                    if (index === -1) {
                         displaySchedule(currentScheduleData, "Ayush's Default Routine", -1);
                    } else {
                        const selectedSchedule = pastSchedules[index];
                        displaySchedule(selectedSchedule, `Past Routine #${index + 1}`, index);
                    }
                }
            });
        });
    </script>
</body>
</html>